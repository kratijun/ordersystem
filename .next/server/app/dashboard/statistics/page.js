(()=>{var e={};e.id=373,e.ids=[373],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},7310:e=>{"use strict";e.exports=require("url")},9546:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c});var a=s(7096),r=s(6132),n=s(7284),i=s.n(n),l=s(2564),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["dashboard",{children:["statistics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8249)),"C:\\Users\\olive\\Desktop\\ordersystem\\app\\dashboard\\statistics\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,5581)),"C:\\Users\\olive\\Desktop\\ordersystem\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,9943)),"C:\\Users\\olive\\Desktop\\ordersystem\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\olive\\Desktop\\ordersystem\\app\\dashboard\\statistics\\page.tsx"],x="/dashboard/statistics/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/statistics/page",pathname:"/dashboard/statistics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3616:(e,t,s)=>{Promise.resolve().then(s.bind(s,1193))},1193:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>StatisticsPage});var a=s(784),r=s(9885),n=s(4800),i=s(9576),l=s(599),d=s(5555),c=s(3422),o=s(3770),x=s(2451),m=s(644),u=s(5574),h=s(9564),p=s(517),j=s(5894),g=s(4782),f=s(7),v=s(5256),y=s(6574);function StatisticsPage(){let{user:e}=(0,n.useAuth)(),[t,s]=(0,r.useState)([]),[b,w]=(0,r.useState)([]),[N,k]=(0,r.useState)(null),[D,S]=(0,r.useState)(!0),[F,P]=(0,r.useState)(!1),[C,_]=(0,r.useState)({from:new Date(Date.now()-2592e6).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]});(0,r.useEffect)(()=>{fetchData()},[]),(0,r.useEffect)(()=>{t.length>0&&calculateStatistics()},[t,b,C]);let fetchData=async()=>{try{P(!0);let[e,t]=await Promise.all([i.kn.getAll(),i.fi.getAll()]);e&&"object"==typeof e&&"success"in e&&e.success&&t&&"object"==typeof t&&"success"in t&&t.success&&(s(e.data),w(t.data))}catch(e){console.error("Fehler beim Laden der Daten:",e)}finally{S(!1),P(!1)}},calculateStatistics=()=>{let e=t.filter(e=>{let t=new Date(e.createdAt).toISOString().split("T")[0];return t>=C.from&&t<=C.to}),s=e.filter(e=>"PAID"===e.status),a=s.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity*t.product.price,0),0),r={};s.forEach(e=>{e.items.forEach(e=>{r[e.product.name]||(r[e.product.name]={quantity:0,revenue:0,name:e.product.name}),r[e.product.name].quantity+=e.quantity,r[e.product.name].revenue+=e.quantity*e.product.price})});let n=Object.values(r).sort((e,t)=>t.revenue-e.revenue).slice(0,10),i={};s.forEach(e=>{let t=new Date(e.createdAt).toISOString().split("T")[0];i[t]||(i[t]={revenue:0,orders:0}),i[t].revenue+=e.items.reduce((e,t)=>e+t.quantity*t.product.price,0),i[t].orders+=1});let l=Object.entries(i).map(([e,t])=>({date:e,...t})).sort((e,t)=>e.date.localeCompare(t.date)),d={};s.forEach(e=>{e.items.forEach(e=>{d[e.product.category]||(d[e.product.category]={quantity:0,revenue:0}),d[e.product.category].quantity+=e.quantity,d[e.product.category].revenue+=e.quantity*e.product.price})});let c=Object.entries(d).map(([e,t])=>({category:e,...t})).sort((e,t)=>t.revenue-e.revenue);k({totalOrders:s.length,totalRevenue:a,averageOrderValue:s.length>0?a/s.length:0,topProducts:n,revenueByDay:l,categoryStats:c})},exportToPDF=async()=>{if(N)try{let e=`
        <html>
          <head>
            <title>Statistiken ${C.from} - ${C.to}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              .header { text-align: center; margin-bottom: 30px; }
              .metrics { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
              .metric { border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
              table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f5f5f5; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>Restaurant Statistiken</h1>
              <p>Zeitraum: ${new Date(C.from).toLocaleDateString("de-DE")} - ${new Date(C.to).toLocaleDateString("de-DE")}</p>
            </div>
            <div class="metrics">
              <div class="metric">
                <h3>Bestellungen</h3>
                <p style="font-size: 24px; font-weight: bold;">${N.totalOrders}</p>
              </div>
              <div class="metric">
                <h3>Gesamtumsatz</h3>
                <p style="font-size: 24px; font-weight: bold;">€${N.totalRevenue.toFixed(2)}</p>
              </div>
            </div>
            <h2>Top Produkte</h2>
            <table>
              <thead>
                <tr><th>Rang</th><th>Produkt</th><th>Menge</th><th>Umsatz</th></tr>
              </thead>
              <tbody>
                ${N.topProducts.map((e,t)=>`<tr><td>${t+1}</td><td>${e.name}</td><td>${e.quantity}</td><td>€${e.revenue.toFixed(2)}</td></tr>`).join("")}
              </tbody>
            </table>
          </body>
        </html>
      `,t=window.open("","_blank");t&&(t.document.write(e),t.document.close(),setTimeout(()=>{t.print()},250))}catch(e){console.error("Fehler beim Exportieren:",e),alert("Fehler beim Exportieren der Statistiken")}};return D?a.jsx("div",{className:"flex justify-center items-center h-64",children:"Laden..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Statistiken & Auswertungen"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Detaillierte Analysen und Berichte f\xfcr Ihr Restaurant"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(d.z,{variant:"outline",onClick:fetchData,disabled:F,children:[a.jsx(m.Z,{className:`h-4 w-4 mr-2 ${F?"animate-spin":""}`}),"Aktualisieren"]}),(0,a.jsxs)(d.z,{variant:"outline",onClick:()=>{if(!N)return;let e=[["Datum","Wochentag","Bestellungen","Umsatz","Durchschnitt pro Bestellung"],...N.revenueByDay.map(e=>[new Date(e.date).toLocaleDateString("de-DE"),new Date(e.date).toLocaleDateString("de-DE",{weekday:"long"}),e.orders.toString(),e.revenue.toFixed(2),(e.revenue/e.orders).toFixed(2)])],t="\uFEFF"+e.map(e=>e.map(e=>`"${e}"`).join(";")).join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`umsatz-statistiken-${C.from}-${C.to}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)},disabled:!N,children:[a.jsx(u.Z,{className:"h-4 w-4 mr-2"}),"Umsatz CSV"]}),(0,a.jsxs)(d.z,{onClick:exportToPDF,disabled:!N,children:[a.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"PDF Bericht"]})]})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[a.jsx(p.Z,{className:"h-5 w-5"}),"Zeitraum ausw\xe4hlen"]})}),a.jsx(l.aY,{children:(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{children:[a.jsx(x._,{htmlFor:"dateFrom",children:"Von"}),a.jsx(o.I,{id:"dateFrom",type:"date",value:C.from,onChange:e=>_({...C,from:e.target.value})})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{htmlFor:"dateTo",children:"Bis"}),a.jsx(o.I,{id:"dateTo",type:"date",value:C.to,onChange:e=>_({...C,to:e.target.value})})]})]})})]}),N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(l.Zb,{children:a.jsx(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(j.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Bestellungen"}),a.jsx("p",{className:"text-3xl font-bold text-gray-900",children:N.totalOrders}),a.jsx("p",{className:"text-sm text-gray-500",children:"bezahlte Bestellungen"})]})]})})}),a.jsx(l.Zb,{children:a.jsx(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(g.Z,{className:"h-8 w-8 text-green-600"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gesamtumsatz"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["€",N.totalRevenue.toFixed(2)]}),a.jsx("p",{className:"text-sm text-gray-500",children:"im ausgew\xe4hlten Zeitraum"})]})]})})}),a.jsx(l.Zb,{children:a.jsx(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(f.Z,{className:"h-8 w-8 text-purple-600"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"\xd8 Bestellwert"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["€",N.averageOrderValue.toFixed(2)]}),a.jsx("p",{className:"text-sm text-gray-500",children:"pro Bestellung"})]})]})})}),a.jsx(l.Zb,{children:a.jsx(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(v.Z,{className:"h-8 w-8 text-orange-600"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aktive Tage"}),a.jsx("p",{className:"text-3xl font-bold text-gray-900",children:N.revenueByDay.length}),a.jsx("p",{className:"text-sm text-gray-500",children:"mit Umsatz"})]})]})})})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[a.jsx(y.Z,{className:"h-5 w-5"}),"Top Produkte"]}),a.jsx(l.SZ,{children:"Die erfolgreichsten Produkte im ausgew\xe4hlten Zeitraum"})]}),(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>{if(!N)return;let e=[["Rang","Produkt","Verkaufte Menge","Umsatz (€)","Anteil am Gesamtumsatz (%)"],...N.topProducts.map((e,t)=>[(t+1).toString(),e.name,e.quantity.toString(),e.revenue.toFixed(2),(e.revenue/N.totalRevenue*100).toFixed(1)])],t="\uFEFF"+e.map(e=>e.map(e=>`"${e}"`).join(";")).join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`top-produkte-${C.from}-${C.to}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)},children:[a.jsx(u.Z,{className:"h-4 w-4 mr-2"}),"Produkte CSV"]})]})}),a.jsx(l.aY,{children:(0,a.jsxs)(c.iA,{children:[a.jsx(c.xD,{children:(0,a.jsxs)(c.SC,{children:[a.jsx(c.ss,{children:"Rang"}),a.jsx(c.ss,{children:"Produkt"}),a.jsx(c.ss,{children:"Verkaufte Menge"}),a.jsx(c.ss,{children:"Umsatz"}),a.jsx(c.ss,{children:"Anteil am Gesamtumsatz"})]})}),a.jsx(c.RM,{children:N.topProducts.map((e,t)=>(0,a.jsxs)(c.SC,{children:[a.jsx(c.pj,{children:a.jsx("span",{className:"w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-bold",children:t+1})}),a.jsx(c.pj,{className:"font-medium",children:e.name}),(0,a.jsxs)(c.pj,{children:[e.quantity,"x"]}),(0,a.jsxs)(c.pj,{className:"font-semibold",children:["€",e.revenue.toFixed(2)]}),a.jsx(c.pj,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mr-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.revenue/N.totalRevenue*100}%`}})}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[(e.revenue/N.totalRevenue*100).toFixed(1),"%"]})]})})]},e.name))})]})})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[a.jsx(p.Z,{className:"h-5 w-5"}),"T\xe4glicher Umsatz"]}),a.jsx(l.SZ,{children:"Umsatzentwicklung \xfcber den ausgew\xe4hlten Zeitraum"})]}),a.jsx(l.aY,{children:(0,a.jsxs)(c.iA,{children:[a.jsx(c.xD,{children:(0,a.jsxs)(c.SC,{children:[a.jsx(c.ss,{children:"Datum"}),a.jsx(c.ss,{children:"Wochentag"}),a.jsx(c.ss,{children:"Bestellungen"}),a.jsx(c.ss,{children:"Umsatz"}),a.jsx(c.ss,{children:"\xd8 pro Bestellung"})]})}),a.jsx(c.RM,{children:N.revenueByDay.map(e=>(0,a.jsxs)(c.SC,{children:[a.jsx(c.pj,{className:"font-medium",children:new Date(e.date).toLocaleDateString("de-DE")}),a.jsx(c.pj,{children:new Date(e.date).toLocaleDateString("de-DE",{weekday:"long"})}),a.jsx(c.pj,{children:e.orders}),(0,a.jsxs)(c.pj,{className:"font-semibold",children:["€",e.revenue.toFixed(2)]}),(0,a.jsxs)(c.pj,{children:["€",(e.revenue/e.orders).toFixed(2)]})]},e.date))})]})})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[a.jsx(y.Z,{className:"h-5 w-5"}),"Kategorien-Analyse"]}),a.jsx(l.SZ,{children:"Umsatz und Verk\xe4ufe nach Produktkategorien"})]}),(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>{if(!N)return;let e=[["Kategorie","Verkaufte Menge","Umsatz (€)","Anteil am Gesamtumsatz (%)"],...N.categoryStats.map(e=>[e.category,e.quantity.toString(),e.revenue.toFixed(2),(e.revenue/N.totalRevenue*100).toFixed(1)])],t="\uFEFF"+e.map(e=>e.map(e=>`"${e}"`).join(";")).join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`kategorien-${C.from}-${C.to}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)},children:[a.jsx(u.Z,{className:"h-4 w-4 mr-2"}),"Kategorien CSV"]})]})}),a.jsx(l.aY,{children:(0,a.jsxs)(c.iA,{children:[a.jsx(c.xD,{children:(0,a.jsxs)(c.SC,{children:[a.jsx(c.ss,{children:"Kategorie"}),a.jsx(c.ss,{children:"Verkaufte Menge"}),a.jsx(c.ss,{children:"Umsatz"}),a.jsx(c.ss,{children:"Anteil am Gesamtumsatz"})]})}),a.jsx(c.RM,{children:N.categoryStats.map(e=>(0,a.jsxs)(c.SC,{children:[a.jsx(c.pj,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),a.jsx("span",{className:"font-medium",children:e.category})]})}),(0,a.jsxs)(c.pj,{children:[e.quantity,"x"]}),(0,a.jsxs)(c.pj,{className:"font-semibold",children:["€",e.revenue.toFixed(2)]}),a.jsx(c.pj,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2 mr-2",children:a.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${e.revenue/N.totalRevenue*100}%`}})}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[(e.revenue/N.totalRevenue*100).toFixed(1),"%"]})]})})]},e.category))})]})})]})]})]})}},8249:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>d});var a=s(5153);let r=(0,a.createProxy)(String.raw`C:\Users\olive\Desktop\ordersystem\app\dashboard\statistics\page.tsx`),{__esModule:n,$$typeof:i}=r,l=r.default,d=l}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[204,80,61,524,500,828,844,41,928,422],()=>__webpack_exec__(9546));module.exports=s})();